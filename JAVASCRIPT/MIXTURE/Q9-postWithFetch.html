<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Validation</title>
    <style>
    .error {
      color: red;
      font-size: 14px;
      margin-left: 15px;
    }
  </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body>
    <form action="" class="m-3" id="form" autocomplete="on">
        <input type="text" name="name" id="name" placeholder="Enter your name" class="form-control-lg m-3">
        <div id="nameError" class="error"></div>

        <input type="text" name="email" id="mail" class="form-control-lg m-3" placeholder="Email id">
        <div id="mailError" class="error"></div>

        <input type="password" name="password" id="pass" class="form-control-lg m-3" placeholder="Password">
        <div id="passError" class="error"></div>

        <input type="submit" value="Submit" class="btn btn-info" id="submit">
    </form>
    <div id="container" class="container-fluid"></div>
    
    <script>
        const form=document.getElementById("form");
        const nameInput=document.getElementById("name");
        const mailInput=document.getElementById("mail");
        const passInput=document.getElementById("pass");

        const nameError=document.getElementById("nameError");
        const mailError=document.getElementById("mailError");
        const passError=document.getElementById("passError");

        const btn=document.getElementById("submit");

        //clear error while typing
        [nameInput, mailInput, passInput].forEach(input => {
            input.addEventListener("input", ()=> {
                input.nextElementSibling.innerText="";
            })
        })

        window.addEventListener("DOMContentLoaded", () => {

        const savedData = localStorage.getItem("formData");

        if (!savedData) return;

        const data = JSON.parse(savedData);

        nameInput.value = data.name || "";
        mailInput.value = data.email || "";
        passInput.value = data.password || "";

        });

        form.addEventListener("submit", async(e) => {
            // Prevent default submit
            e.preventDefault();

            let hasError=false;

            // reset errors
            nameError.innerText="";
            mailError.innerText="";
            passError.innerText="";

            const name=nameInput.value.trim();
            const mail=mailInput.value.trim();
            const psw=passInput.value.trim();

            //required checks for input
            if(name==="") {
                nameError.innerText="Name is required";
                hasError=true;
            }

            if(mail==="") {
                mailError.innerText="Email is required";
                hasError=true;
            }

            if(psw==="") {
                passError.innerText="Password is required";
                hasError=true;
            }

            //email regex
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if(mail && !emailRegex.test(mail)) {
                mailError.innerText=" Invalid email format";
                hasError=true;
            }

            //stop submit if error
            if(hasError) return;

            const div=document.getElementById("container");
            // Create FormData(form)
            const formData=new FormData(form);
            
            // Loop over FormData
            const obj={};

            for(let [key,value] of formData) {
                obj[key] = value;
            }
            // value, replacer, space
            div.innerHTML=`<h3>Using FormData</h3><p>${JSON.stringify(obj,null,2)}</p>`;

            btn.disabled=true;
            btn.value="Submitting...";

            //fetch post
            try {
                const response=await fetch(
                    "https://jsonplaceholder.typicode.com/posts",
                {
                    method:"POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(obj)
                });

                const data=await response.json();
                console.log(data);

                alert("Form submitted successfully üéâ");
                localStorage.setItem("formData", JSON.stringify(obj));

            } catch (error) {
                console.error("error", error);
                alert("Something went wrong ‚ùå");

            } finally {
                btn.disabled=false;
                btn.value="Submit";
            }


        });
    </script>
</body>
</html>